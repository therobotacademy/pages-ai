<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Codelab Viewer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@300;400;500&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
<style>
  :root {
    --google-blue: #1a73e8;
    --google-blue-dark: #1557b0;
    --google-blue-light: #e8f0fe;
    --google-green: #0f9d58;
    --google-yellow: #f9ab00;
    --google-red: #d93025;
    --google-grey-50: #f8f9fa;
    --google-grey-100: #f1f3f4;
    --google-grey-200: #e8eaed;
    --google-grey-300: #dadce0;
    --google-grey-500: #9aa0a6;
    --google-grey-700: #5f6368;
    --google-grey-900: #202124;
    --sidebar-width: 256px;
    --header-height: 64px;
    --progress-height: 4px;
    --content-max-width: 800px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Roboto', 'Google Sans', sans-serif;
    font-size: 14px;
    line-height: 1.6;
    color: var(--google-grey-900);
    background: #fff;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
  #progress-bar-container {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: var(--progress-height);
    background: var(--google-grey-200);
    z-index: 1000;
  }
  #progress-bar {
    height: 100%;
    background: var(--google-blue);
    transition: width 0.4s cubic-bezier(0.4,0,0.2,1);
    width: 0%;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  #header {
    position: fixed;
    top: var(--progress-height);
    left: 0; right: 0;
    height: var(--header-height);
    background: #fff;
    border-bottom: 1px solid var(--google-grey-200);
    display: flex;
    align-items: center;
    padding: 0 20px;
    z-index: 900;
    gap: 16px;
  }
  #header .logo-link {
    display: flex;
    align-items: center;
    text-decoration: none;
    gap: 10px;
    flex-shrink: 0;
  }
  #header .logo-link svg { height: 24px; }
  #header .codelab-title {
    font-family: 'Google Sans', sans-serif;
    font-size: 18px;
    font-weight: 500;
    color: var(--google-grey-900);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
  }
  #header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }
  .header-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    border: 1px solid var(--google-grey-300);
    border-radius: 4px;
    background: #fff;
    color: var(--google-grey-700);
    font-family: 'Google Sans', sans-serif;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.15s, box-shadow 0.15s;
    text-decoration: none;
  }
  .header-btn:hover { background: var(--google-grey-50); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
  .header-btn svg { width: 16px; height: 16px; }
  #menu-toggle {
    display: none;
    background: none;
    border: none;
    padding: 8px;
    cursor: pointer;
    color: var(--google-grey-700);
  }
  #menu-toggle svg { width: 24px; height: 24px; }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  #layout {
    display: flex;
    padding-top: calc(var(--header-height) + var(--progress-height));
    min-height: 100vh;
  }

  /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
  #sidebar {
    width: var(--sidebar-width);
    min-width: var(--sidebar-width);
    background: #fff;
    border-right: 1px solid var(--google-grey-200);
    position: fixed;
    top: calc(var(--header-height) + var(--progress-height));
    bottom: 0;
    left: 0;
    overflow-y: auto;
    padding: 16px 0;
    transition: transform 0.3s ease;
  }
  #sidebar.hidden { transform: translateX(-100%); }

  .sidebar-nav-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 10px 20px;
    cursor: pointer;
    transition: background 0.15s;
    border-left: 3px solid transparent;
    position: relative;
  }
  .sidebar-nav-item:hover { background: var(--google-grey-50); }
  .sidebar-nav-item.active {
    background: var(--google-blue-light);
    border-left-color: var(--google-blue);
  }
  .step-number {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--google-grey-200);
    color: var(--google-grey-700);
    font-size: 12px;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-family: 'Google Sans', sans-serif;
    transition: background 0.2s, color 0.2s;
  }
  .sidebar-nav-item.active .step-number {
    background: var(--google-blue);
    color: #fff;
  }
  .sidebar-nav-item.completed .step-number {
    background: var(--google-green);
    color: #fff;
  }
  .step-info { flex: 1; min-width: 0; }
  .step-title {
    font-size: 13px;
    font-weight: 400;
    color: var(--google-grey-700);
    line-height: 1.4;
    word-break: break-word;
  }
  .sidebar-nav-item.active .step-title { color: var(--google-blue); font-weight: 500; }
  .step-duration {
    font-size: 11px;
    color: var(--google-grey-500);
    margin-top: 2px;
  }
  .sidebar-section-header {
    padding: 12px 20px 4px;
    font-size: 11px;
    font-weight: 500;
    color: var(--google-grey-500);
    text-transform: uppercase;
    letter-spacing: 0.8px;
  }

  /* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
  #main-content {
    flex: 1;
    margin-left: var(--sidebar-width);
    padding: 40px 40px 100px;
    max-width: calc(var(--content-max-width) + var(--sidebar-width) + 80px);
  }
  #step-content {
    max-width: var(--content-max-width);
  }

  /* ‚îÄ‚îÄ STEP CONTENT STYLES ‚îÄ‚îÄ */
  #step-content h1 {
    font-family: 'Google Sans', sans-serif;
    font-size: 28px;
    font-weight: 400;
    color: var(--google-grey-900);
    margin-bottom: 24px;
    line-height: 1.3;
  }
  #step-content h2 {
    font-family: 'Google Sans', sans-serif;
    font-size: 22px;
    font-weight: 400;
    color: var(--google-grey-900);
    margin: 32px 0 12px;
    line-height: 1.3;
  }
  #step-content h3 {
    font-family: 'Google Sans', sans-serif;
    font-size: 18px;
    font-weight: 500;
    color: var(--google-grey-900);
    margin: 24px 0 8px;
  }
  #step-content h4 {
    font-family: 'Google Sans', sans-serif;
    font-size: 15px;
    font-weight: 500;
    margin: 20px 0 6px;
  }
  #step-content p {
    margin-bottom: 16px;
    color: var(--google-grey-900);
    line-height: 1.7;
    font-size: 14px;
  }
  #step-content a { color: var(--google-blue); text-decoration: none; }
  #step-content a:hover { text-decoration: underline; }
  #step-content strong { font-weight: 500; }
  #step-content em { font-style: italic; }

  /* Lists */
  #step-content ul, #step-content ol {
    margin: 8px 0 16px 24px;
  }
  #step-content li {
    margin-bottom: 6px;
    line-height: 1.6;
    font-size: 14px;
  }

  /* Inline code */
  #step-content code:not([class]) {
    background: var(--google-grey-100);
    color: #c5221f;
    font-family: 'Roboto Mono', monospace;
    font-size: 12px;
    padding: 1px 6px;
    border-radius: 3px;
    word-break: break-word;
  }

  /* Code blocks */
  .code-block-wrapper {
    position: relative;
    margin: 16px 0;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 1px 4px rgba(0,0,0,0.15);
  }
  .code-block-header {
    background: #1e2227;
    padding: 8px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .code-lang-label {
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    color: #9aa0a6;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .copy-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    background: rgba(255,255,255,0.1);
    border: none;
    color: #9aa0a6;
    font-size: 11px;
    font-family: 'Google Sans', sans-serif;
    padding: 3px 8px;
    border-radius: 3px;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
  }
  .copy-btn:hover { background: rgba(255,255,255,0.2); color: #e8eaed; }
  .copy-btn.copied { color: #81c995; }
  .code-block-wrapper pre {
    margin: 0 !important;
    border-radius: 0 !important;
    background: #282c34 !important;
    padding: 16px !important;
    overflow-x: auto;
    font-size: 13px !important;
    line-height: 1.5 !important;
  }
  .code-block-wrapper pre code {
    font-family: 'Roboto Mono', monospace !important;
    font-size: 13px !important;
  }

  /* Tables */
  #step-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0;
    font-size: 13px;
  }
  #step-content th {
    background: var(--google-grey-100);
    font-weight: 500;
    text-align: left;
    padding: 10px 12px;
    border: 1px solid var(--google-grey-300);
    font-family: 'Google Sans', sans-serif;
  }
  #step-content td {
    padding: 10px 12px;
    border: 1px solid var(--google-grey-300);
    vertical-align: top;
  }
  #step-content tr:hover td { background: var(--google-grey-50); }

  /* Images */
  #step-content img {
    max-width: 100%;
    border-radius: 6px;
    margin: 16px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
  }

  /* Callout boxes */
  .callout {
    display: flex;
    gap: 12px;
    padding: 14px 16px;
    border-radius: 6px;
    margin: 16px 0;
    font-size: 14px;
    line-height: 1.6;
  }
  .callout-icon { font-size: 18px; flex-shrink: 0; margin-top: 1px; }
  .callout-body { flex: 1; }
  .callout-body p:last-child { margin-bottom: 0; }
  .callout.note { background: #e8f0fe; border-left: 4px solid var(--google-blue); }
  .callout.tip  { background: #e6f4ea; border-left: 4px solid var(--google-green); }
  .callout.warn { background: #fef7e0; border-left: 4px solid var(--google-yellow); }
  .callout.important { background: #fce8e6; border-left: 4px solid var(--google-red); }

  /* Horizontal rules */
  #step-content hr { border: none; border-top: 1px solid var(--google-grey-200); margin: 24px 0; }

  /* Blockquote */
  #step-content blockquote {
    border-left: 4px solid var(--google-grey-300);
    margin: 16px 0;
    padding: 8px 16px;
    color: var(--google-grey-700);
    font-style: italic;
  }

  /* Step header */
  .step-header {
    display: flex;
    align-items: baseline;
    gap: 12px;
    margin-bottom: 28px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--google-grey-200);
  }
  .step-header-num {
    font-family: 'Google Sans', sans-serif;
    font-size: 14px;
    color: var(--google-grey-500);
    white-space: nowrap;
  }
  .step-header-title {
    font-family: 'Google Sans', sans-serif;
    font-size: 28px;
    font-weight: 400;
    color: var(--google-grey-900);
    line-height: 1.3;
  }
  .step-meta {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-top: 8px;
    flex-wrap: wrap;
  }
  .step-meta-item {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    color: var(--google-grey-500);
  }
  .step-meta-item svg { width: 14px; height: 14px; }

  /* ‚îÄ‚îÄ NAVIGATION BUTTONS ‚îÄ‚îÄ */
  #nav-footer {
    position: fixed;
    bottom: 0;
    left: var(--sidebar-width);
    right: 0;
    background: #fff;
    border-top: 1px solid var(--google-grey-200);
    padding: 14px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 800;
  }
  .nav-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border-radius: 4px;
    font-family: 'Google Sans', sans-serif;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s;
    border: none;
    text-decoration: none;
  }
  .nav-btn.prev {
    background: var(--google-grey-100);
    color: var(--google-grey-700);
  }
  .nav-btn.prev:hover { background: var(--google-grey-200); }
  .nav-btn.next {
    background: var(--google-blue);
    color: #fff;
  }
  .nav-btn.next:hover { background: var(--google-blue-dark); box-shadow: 0 2px 6px rgba(26,115,232,0.4); }
  .nav-btn:disabled { opacity: 0.4; cursor: not-allowed; pointer-events: none; }
  .nav-btn svg { width: 18px; height: 18px; }
  .nav-step-info {
    font-size: 12px;
    color: var(--google-grey-500);
  }

  /* ‚îÄ‚îÄ LANDING / DROP ZONE ‚îÄ‚îÄ */
  #landing {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 40px;
    background: var(--google-grey-50);
  }
  .landing-logo {
    margin-bottom: 32px;
  }
  .landing-logo svg { height: 40px; }
  .landing-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.06);
    padding: 48px;
    max-width: 540px;
    width: 100%;
    text-align: center;
  }
  .landing-card h1 {
    font-family: 'Google Sans', sans-serif;
    font-size: 26px;
    font-weight: 400;
    color: var(--google-grey-900);
    margin-bottom: 10px;
  }
  .landing-card p {
    font-size: 14px;
    color: var(--google-grey-700);
    margin-bottom: 36px;
    line-height: 1.6;
  }
  #drop-zone {
    border: 2px dashed var(--google-grey-300);
    border-radius: 8px;
    padding: 48px 32px;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    position: relative;
  }
  #drop-zone:hover, #drop-zone.dragover {
    border-color: var(--google-blue);
    background: var(--google-blue-light);
  }
  #drop-zone input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }
  .drop-icon { margin-bottom: 16px; color: var(--google-grey-500); }
  .drop-icon svg { width: 48px; height: 48px; }
  .drop-label {
    font-family: 'Google Sans', sans-serif;
    font-size: 15px;
    color: var(--google-grey-700);
    margin-bottom: 6px;
  }
  .drop-sublabel { font-size: 12px; color: var(--google-grey-500); }
  .drop-label span { color: var(--google-blue); font-weight: 500; }

  .format-hint {
    margin-top: 24px;
    text-align: left;
    background: var(--google-grey-50);
    border-radius: 6px;
    padding: 16px;
  }
  .format-hint h4 {
    font-family: 'Google Sans', sans-serif;
    font-size: 12px;
    font-weight: 500;
    color: var(--google-grey-700);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .format-hint code {
    display: block;
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    color: var(--google-grey-700);
    line-height: 1.8;
    white-space: pre;
  }

  /* ‚îÄ‚îÄ CONGRATULATIONS STEP ‚îÄ‚îÄ */
  .congrats-banner {
    background: linear-gradient(135deg, #1a73e8 0%, #0f9d58 100%);
    border-radius: 8px;
    padding: 32px;
    color: #fff;
    text-align: center;
    margin-bottom: 24px;
  }
  .congrats-banner h2 {
    font-family: 'Google Sans', sans-serif;
    font-size: 28px;
    font-weight: 400;
    margin-bottom: 8px;
    color: #fff;
  }
  .congrats-banner p { opacity: 0.9; font-size: 15px; color: #fff; }
  .congrats-icon { font-size: 48px; margin-bottom: 12px; }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  #toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--google-grey-900);
    color: #fff;
    padding: 10px 20px;
    border-radius: 4px;
    font-size: 13px;
    font-family: 'Google Sans', sans-serif;
    opacity: 0;
    transition: opacity 0.3s, transform 0.3s;
    pointer-events: none;
    z-index: 9999;
    white-space: nowrap;
  }
  #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
  @media (max-width: 768px) {
    #menu-toggle { display: flex; }
    #sidebar {
      z-index: 850;
      box-shadow: 2px 0 8px rgba(0,0,0,0.15);
    }
    #sidebar:not(.hidden) { transform: translateX(0); }
    #sidebar.hidden { transform: translateX(-100%); }
    #main-content { margin-left: 0; padding: 24px 20px 100px; }
    #nav-footer { left: 0; padding: 14px 20px; }
    .landing-card { padding: 32px 24px; }
  }

  /* ‚îÄ‚îÄ PRINT / PDF ‚îÄ‚îÄ */
  @media print {
    #header, #sidebar, #nav-footer, #progress-bar-container { display: none !important; }
    #layout { padding-top: 0; }
    #main-content { margin-left: 0; padding: 20px; }
    #step-content { max-width: 100%; }
    .code-block-wrapper { box-shadow: none; border: 1px solid #ddd; }
    .copy-btn { display: none; }
    body { font-size: 11pt; }
  }

  /* ‚îÄ‚îÄ SIDEBAR OVERLAY (mobile) ‚îÄ‚îÄ */
  #sidebar-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 840;
  }
  #sidebar-overlay.visible { display: block; }

  /* Animation */
  #step-content { animation: fadeIn 0.2s ease; }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<!-- LANDING SCREEN -->
<div id="landing" style="display:none">
  <div class="landing-logo">
    <svg viewBox="0 0 200 30" fill="none" xmlns="http://www.w3.org/2000/svg">
      <text x="0" y="24" font-family="Google Sans, sans-serif" font-size="22" fill="#5f6368">Google</text>
      <text x="72" y="24" font-family="Google Sans, sans-serif" font-size="22" fill="#1a73e8"> Codelabs</text>
    </svg>
  </div>
  <div class="landing-card">
    <h1>Codelab Viewer</h1>
    <p>Convierte tu fichero Markdown al formato interactivo de Google Codelabs. Arrastra tu fichero <strong>.md</strong> para comenzar.</p>

    <div id="drop-zone">
      <input type="file" id="file-input" accept=".md,.markdown,text/markdown,text/plain">
      <div class="drop-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
        </svg>
      </div>
      <div class="drop-label"><span>Haz clic para seleccionar</span> o arrastra aqu√≠</div>
      <div class="drop-sublabel">Ficheros .md ¬∑ Markdown</div>
    </div>

    <div class="format-hint">
      <h4>Formato esperado del Markdown</h4>
      <code>---
title: Mi Codelab
summary: Descripci√≥n breve
authors: Tu Nombre
duration: 30
---

## Introducci√≥n
Contenido del primer paso...

---

## Paso 2: Instalaci√≥n
duration: 5

Contenido del segundo paso...

---

## Paso Final: Conclusi√≥n</code>
    </div>
  </div>
</div>

<!-- CODELAB APP (hidden initially) -->
<div id="app">
  <!-- Progress bar -->
  <div id="progress-bar-container">
    <div id="progress-bar"></div>
  </div>

  <!-- Header -->
  <header id="header">
    <button id="menu-toggle" aria-label="Toggle menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </button>
    <a href="#" class="logo-link" id="home-link">
      <svg viewBox="0 0 140 20" xmlns="http://www.w3.org/2000/svg">
        <text x="0" y="16" font-family="Google Sans, sans-serif" font-size="16" fill="#5f6368">Google</text>
        <text x="52" y="16" font-family="Google Sans, sans-serif" font-size="16" fill="#1a73e8"> Codelabs</text>
      </svg>
    </a>
    <span class="codelab-title" id="header-title"></span>
    <div id="header-actions">
      <button class="header-btn" id="pdf-btn" title="Exportar a PDF">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/>
          <line x1="12" y1="18" x2="12" y2="12"/><polyline points="8 15 12 18 16 15"/>
        </svg>
        PDF
      </button>
      <button class="header-btn" id="reset-btn" title="Cargar otro fichero">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/>
        </svg>
        Nuevo
      </button>
    </div>
  </header>

  <!-- Sidebar overlay (mobile) -->
  <div id="sidebar-overlay"></div>

  <!-- Layout -->
  <div id="layout">
    <!-- Sidebar -->
    <nav id="sidebar">
      <div class="sidebar-section-header">CONTENIDO</div>
      <div id="sidebar-nav"></div>
    </nav>

    <!-- Main content -->
    <main id="main-content">
      <div id="step-content"></div>
    </main>
  </div>

  <!-- Bottom navigation -->
  <div id="nav-footer">
    <button class="nav-btn prev" id="btn-prev">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
      Anterior
    </button>
    <span class="nav-step-info" id="nav-step-info"></span>
    <button class="nav-btn next" id="btn-next">
      Siguiente
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <polyline points="9 18 15 12 9 6"/>
      </svg>
    </button>
  </div>
</div>

<!-- Toast -->
<div id="toast"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MARKDOWN PARSER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const MarkdownParser = {
  parseFrontmatter(text) {
    const meta = { title: 'Codelab', summary: '', authors: '', duration: 0 };
    const fm = text.match(/^---\s*\n([\s\S]*?)\n---\s*\n/);
    if (!fm) return { meta, body: text };
    const body = text.slice(fm[0].length);
    fm[1].split('\n').forEach(line => {
      const m = line.match(/^(\w+)\s*:\s*(.+)$/);
      if (m) meta[m[1].trim()] = m[2].trim();
    });
    if (meta.duration) meta.duration = parseInt(meta.duration) || 0;
    return { meta, body };
  },

  parseSteps(body) {
    // Split by --- separator (at least 3 dashes on own line)
    const rawParts = body.split(/\n---+\n/);
    const steps = [];

    rawParts.forEach((part, idx) => {
      part = part.trim();
      if (!part) return;

      // Extract per-step metadata (duration: N lines before ## or at top)
      let stepDuration = 0;
      let content = part;

      // Check for inline duration field (duration: 5 on its own line within the step)
      const durationMatch = content.match(/^duration\s*:\s*(\d+)\s*\n/m);
      if (durationMatch) {
        stepDuration = parseInt(durationMatch[1]);
        content = content.replace(durationMatch[0], '');
      }

      // Extract title from first H2 (## Title)
      const h2Match = content.match(/^#{1,2}\s+(.+)$/m);
      let title = h2Match ? h2Match[1].trim() : `Paso ${idx + 1}`;
      // Remove leading numbering like "1. " or "1: "
      title = title.replace(/^\d+[\.\:]\s*/, '');

      // Remove the H2 from content (it'll be rendered as step header)
      if (h2Match) {
        content = content.replace(h2Match[0], '').trim();
      }

      steps.push({ title, content, duration: stepDuration, index: idx });
    });

    return steps;
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MARKDOWN RENDERER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const MarkdownRenderer = {
  render(md) {
    let html = md;

    // Protect code blocks first
    const codeBlocks = [];
    html = html.replace(/```(\w*)\n?([\s\S]*?)```/g, (_, lang, code) => {
      const idx = codeBlocks.length;
      codeBlocks.push({ lang: lang || 'text', code: code.trimEnd() });
      return `%%CODEBLOCK_${idx}%%`;
    });

    // Callout boxes: > aside negative/positive/warning/special
    html = html.replace(/^>\s*aside\s+(negative|positive|warning|special)\s*\n((?:>.*\n?)*)/gm, (_, type, body) => {
      const content = body.replace(/^>\s?/gm, '').trim();
      const typeMap = { negative: 'warn', positive: 'tip', warning: 'important', special: 'note' };
      const iconMap = { warn: '‚ö†Ô∏è', tip: 'üí°', important: 'üö®', note: '‚ÑπÔ∏è' };
      const cls = typeMap[type] || 'note';
      return `<div class="callout ${cls}"><span class="callout-icon">${iconMap[cls]}</span><div class="callout-body">${this.render(content)}</div></div>`;
    });

    // Standard blockquote
    html = html.replace(/^((?:>.*\n?)+)/gm, (match) => {
      const content = match.replace(/^>\s?/gm, '').trim();
      return `<blockquote>${content}</blockquote>`;
    });

    // Headings
    html = html.replace(/^#{6}\s+(.+)$/gm, '<h6>$1</h6>');
    html = html.replace(/^#{5}\s+(.+)$/gm, '<h5>$1</h5>');
    html = html.replace(/^#{4}\s+(.+)$/gm, '<h4>$1</h4>');
    html = html.replace(/^#{3}\s+(.+)$/gm, '<h3>$1</h3>');
    html = html.replace(/^#{2}\s+(.+)$/gm, '<h2>$1</h2>');
    html = html.replace(/^#{1}\s+(.+)$/gm, '<h1>$1</h1>');

    // Tables
    html = html.replace(/^\|(.+)\|\s*\n\|[-| :]+\|\s*\n((?:\|.+\|\s*\n?)*)/gm, (_, header, rows) => {
      const ths = header.split('|').map(c => c.trim()).filter(Boolean)
        .map(c => `<th>${c}</th>`).join('');
      const trs = rows.trim().split('\n').map(row => {
        const tds = row.split('|').map(c => c.trim()).filter(Boolean)
          .map(c => `<td>${c}</td>`).join('');
        return `<tr>${tds}</tr>`;
      }).join('');
      return `<table><thead><tr>${ths}</tr></thead><tbody>${trs}</tbody></table>`;
    });

    // Ordered lists
    html = html.replace(/^((?:\d+\.\s+.+\n?)+)/gm, match => {
      const items = match.trim().split('\n')
        .map(l => l.replace(/^\d+\.\s+/, '').trim())
        .map(l => `<li>${l}</li>`).join('');
      return `<ol>${items}</ol>`;
    });

    // Unordered lists
    html = html.replace(/^((?:[-*+]\s+.+\n?)+)/gm, match => {
      const items = match.trim().split('\n')
        .map(l => l.replace(/^[-*+]\s+/, '').trim())
        .map(l => `<li>${l}</li>`).join('');
      return `<ul>${items}</ul>`;
    });

    // Horizontal rules (already split by parser, but some may remain)
    html = html.replace(/^---+$/gm, '<hr>');

    // Bold + italic
    html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
    html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');
    html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
    html = html.replace(/_([^_]+)_/g, '<em>$1</em>');

    // Inline code
    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

    // Links and images
    html = html.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');
    html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');

    // Paragraphs (lines that aren't blocks)
    html = html.replace(/^(?!<[a-z]|%%CODE)(.+)$/gm, '<p>$1</p>');

    // Restore code blocks
    html = html.replace(/%%CODEBLOCK_(\d+)%%/g, (_, i) => {
      const { lang, code } = codeBlocks[parseInt(i)];
      const safeCode = code.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      const langLabel = lang !== 'text' ? lang : '';
      return `<div class="code-block-wrapper">
        <div class="code-block-header">
          <span class="code-lang-label">${langLabel}</span>
          <button class="copy-btn" onclick="copyCode(this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12">
              <rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
            </svg>
            Copiar
          </button>
        </div>
        <pre><code class="language-${lang}">${safeCode}</code></pre>
      </div>`;
    });

    // Clean up extra blank lines
    html = html.replace(/\n{3,}/g, '\n\n');
    return html;
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CODELAB APP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CodelabApp = {
  steps: [],
  meta: {},
  currentStep: 0,
  storageKey: '',

  init(markdownText) {
    const { meta, body } = MarkdownParser.parseFrontmatter(markdownText);
    this.meta = meta;
    this.steps = MarkdownParser.parseSteps(body);

    if (!this.steps.length) {
      showToast('No se encontraron pasos. Usa --- para separar secciones.');
      return;
    }

    this.storageKey = 'codelab_step_' + btoa(meta.title || 'codelab').replace(/[^a-z0-9]/gi,'').slice(0,20);

    // Restore progress
    const saved = parseInt(localStorage.getItem(this.storageKey)) || 0;
    this.currentStep = Math.min(saved, this.steps.length - 1);

    // Switch to app view
    document.getElementById('landing').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    document.getElementById('header-title').textContent = meta.title || 'Codelab';
    document.title = (meta.title || 'Codelab') + ' | Google Codelabs';

    this.renderSidebar();
    this.renderStep(this.currentStep);
  },

  renderSidebar() {
    const nav = document.getElementById('sidebar-nav');
    nav.innerHTML = this.steps.map((step, i) => {
      const cls = i < this.currentStep ? 'completed' : i === this.currentStep ? 'active' : '';
      const icon = i < this.currentStep ? '‚úì' : (i + 1);
      const dur = step.duration ? `<div class="step-duration">‚è± ${step.duration} min</div>` : '';
      return `<div class="sidebar-nav-item ${cls}" onclick="CodelabApp.goTo(${i})">
        <div class="step-number">${icon}</div>
        <div class="step-info">
          <div class="step-title">${escapeHtml(step.title)}</div>
          ${dur}
        </div>
      </div>`;
    }).join('');
  },

  renderStep(idx) {
    const step = this.steps[idx];
    const isLast = idx === this.steps.length - 1;
    const stepNum = idx + 1;
    const totalSteps = this.steps.length;

    // Step meta row
    const metaItems = [];
    if (step.duration) metaItems.push(`<span class="step-meta-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>${step.duration} minutos</span>`);

    const totalDuration = this.steps.reduce((s, st) => s + (st.duration||0), 0);
    if (idx === 0 && totalDuration) metaItems.push(`<span class="step-meta-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Total: ${totalDuration} min</span>`);
    if (idx === 0 && this.meta.authors) metaItems.push(`<span class="step-meta-item">‚úçÔ∏è ${escapeHtml(this.meta.authors)}</span>`);

    const metaHtml = metaItems.length ? `<div class="step-meta">${metaItems.join('')}</div>` : '';

    // Congratulations banner for last step
    const congratsBanner = isLast ? `
      <div class="congrats-banner">
        <div class="congrats-icon">üéâ</div>
        <h2>¬°Felicidades!</h2>
        <p>${escapeHtml(this.meta.summary || 'Has completado el codelab.')}</p>
      </div>` : '';

    const content = `
      <div class="step-header">
        <span class="step-header-num">Paso ${stepNum} de ${totalSteps}</span>
        <h1 class="step-header-title">${escapeHtml(step.title)}</h1>
      </div>
      ${metaHtml}
      ${congratsBanner}
      ${MarkdownRenderer.render(step.content)}
    `;

    const el = document.getElementById('step-content');
    el.innerHTML = content;
    el.style.animation = 'none';
    el.offsetHeight; // reflow
    el.style.animation = '';

    // Syntax highlight
    if (window.Prism) Prism.highlightAllUnder(el);

    // Update progress bar
    const pct = totalSteps > 1 ? (idx / (totalSteps - 1)) * 100 : 100;
    document.getElementById('progress-bar').style.width = pct + '%';

    // Update nav buttons
    const btnPrev = document.getElementById('btn-prev');
    const btnNext = document.getElementById('btn-next');
    btnPrev.disabled = idx === 0;
    btnNext.innerHTML = isLast
      ? 'Completar <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="18" height="18"><polyline points="20 6 9 17 4 12"/></svg>'
      : 'Siguiente <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="18" height="18"><polyline points="9 18 15 12 9 6"/></svg>';
    document.getElementById('nav-step-info').textContent = `${stepNum} / ${totalSteps}`;

    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });

    // Persist progress
    localStorage.setItem(this.storageKey, idx);
  },

  goTo(idx) {
    if (idx < 0 || idx >= this.steps.length) return;
    this.currentStep = idx;
    this.renderSidebar();
    this.renderStep(idx);

    // Close mobile sidebar
    if (window.innerWidth <= 768) {
      document.getElementById('sidebar').classList.add('hidden');
      document.getElementById('sidebar-overlay').classList.remove('visible');
    }
  },

  next() { this.goTo(this.currentStep + 1); },
  prev() { this.goTo(this.currentStep - 1); },

  exportPDF() {
    showToast('Preparando PDF... Usa el di√°logo de impresi√≥n del navegador.');
    setTimeout(() => window.print(), 600);
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FILE LOADER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadFile(file) {
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      CodelabApp.init(e.target.result);
    } catch (err) {
      showToast('Error al parsear el fichero: ' + err.message);
      console.error(err);
    }
  };
  reader.readAsText(file);
}

// Drop zone
const dropZone = document.getElementById('drop-zone');
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (file) loadFile(file);
});

document.getElementById('file-input').addEventListener('change', e => {
  if (e.target.files[0]) loadFile(e.target.files[0]);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UI CONTROLS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('btn-prev').addEventListener('click', () => CodelabApp.prev());
document.getElementById('btn-next').addEventListener('click', () => CodelabApp.next());
document.getElementById('pdf-btn').addEventListener('click', () => CodelabApp.exportPDF());
document.getElementById('reset-btn').addEventListener('click', () => {
  document.getElementById('app').style.display = 'none';
  document.getElementById('landing').style.display = 'flex';
  document.getElementById('file-input').value = '';
});
document.getElementById('home-link').addEventListener('click', e => {
  e.preventDefault();
  CodelabApp.goTo(0);
});

// Mobile menu
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('sidebar-overlay');
document.getElementById('menu-toggle').addEventListener('click', () => {
  sidebar.classList.toggle('hidden');
  overlay.classList.toggle('visible');
});
overlay.addEventListener('click', () => {
  sidebar.classList.add('hidden');
  overlay.classList.remove('visible');
});

// Keyboard navigation
document.addEventListener('keydown', e => {
  if (document.getElementById('app').style.display === 'none') return;
  if (e.key === 'ArrowRight' || e.key === 'ArrowDown') CodelabApp.next();
  if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') CodelabApp.prev();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function copyCode(btn) {
  const code = btn.closest('.code-block-wrapper').querySelector('code').textContent;
  navigator.clipboard.writeText(code).then(() => {
    btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><polyline points="20 6 9 17 4 12"/></svg> Copiado';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg> Copiar';
      btn.classList.remove('copied');
    }, 2000);
  });
}

function escapeHtml(str) {
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AUTO-LOAD EMBEDDED MARKDOWN (Published Version)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const EMBEDDED_MARKDOWN = `---
title: Introducci√≥n a Google ADK con Python
summary: Aprende a construir agentes de IA con Google Agent Development Kit (ADK) paso a paso.
authors: Bernardo Ronquillo
duration: 45
---
## Bienvenida y Visi√≥n General

En este codelab aprender√°s a construir un **agente de IA** usando el Google Agent Development Kit (ADK), una herramienta poderosa para crear aplicaciones conversacionales inteligentes.

> aside positive
> **¬øQu√© aprender√°s?**
> Al finalizar este codelab ser√°s capaz de crear agentes con herramientas personalizadas, conectarte a APIs externas y orquestar m√∫ltiples agentes.

### ¬øQu√© es Google ADK?

Google ADK (Agent Development Kit) es un framework flexible para desarrollar y desplegar agentes de IA. Sus caracter√≠sticas principales son:

- **Model-agnostic**: Compatible con Gemini, GPT-4 y otros modelos
- **Framework-agnostic**: Funciona con LangChain, LlamaIndex, etc.
- **Production-ready**: Dise√±ado para entornos de producci√≥n

### Arquitectura general

El ADK sigue un patr√≥n de arquitectura modular:

| Componente           | Descripci√≥n                                        |
| -------------------- | --------------------------------------------------- |
| **LlmAgent**   | Agente principal que gestiona la conversaci√≥n      |
| **Tools**      | Funciones que el agente puede invocar               |
| **MCPToolset** | Conjunto de herramientas via Model Context Protocol |
| **Runner**     | Ejecutor del agente en local o cloud                |

---

## Antes de Comenzar

duration: 5

Aseg√∫rate de tener todo lo necesario antes de empezar.

### Requisitos previos

- Python **3.10 o superior**
- Una cuenta de Google Cloud con facturaci√≥n habilitada
- Acceso a la API de Gemini

> aside negative
> **Importante:** Sin una cuenta de Google Cloud con facturaci√≥n activa no podr√°s completar algunos pasos de este codelab.

### Verificar tu entorno

Comprueba tu versi√≥n de Python:

\`\`\`bash
python --version
# Debe mostrar Python 3.10.x o superior
\`\`\`

Instala las herramientas de Google Cloud:

\`\`\`bash
# Instalar gcloud CLI
curl -O https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-cli-linux-x86_64.tar.gz
tar -xf google-cloud-cli-linux-x86_64.tar.gz
./google-cloud-sdk/install.sh
\`\`\`

Autentica tu cuenta:

\`\`\`bash
gcloud auth login
gcloud config set project YOUR_PROJECT_ID
\`\`\`

---

## Instalaci√≥n de ADK

duration: 8

Con el entorno listo, instalamos las dependencias del proyecto.

### Crear el entorno virtual

\`\`\`bash
# Crear directorio del proyecto
mkdir mi-agente-adk && cd mi-agente-adk

# Crear entorno virtual
python -m venv .venv
source .venv/bin/activate  # En Windows: .venv\\Scripts\\activate
\`\`\`

### Instalar dependencias

\`\`\`bash
pip install google-adk google-generativeai python-dotenv
\`\`\`

### Configurar variables de entorno

Crea un fichero \`.env\` en la ra√≠z del proyecto:

\`\`\`bash
cat > .env << EOF
GOOGLE_GENAI_USE_VERTEXAI=TRUE
GOOGLE_CLOUD_PROJECT=tu-project-id
GOOGLE_CLOUD_LOCATION=us-central1
GOOGLE_API_KEY=tu-api-key
EOF
\`\`\`

> aside tip
> **Tip:** A√±ade \`.env\` a tu \`.gitignore\` para no exponer credenciales en repositorios p√∫blicos.

---

## Crear tu Primer Agente

duration: 12

¬°Manos a la obra! Vamos a crear un agente conversacional b√°sico.

### Estructura del proyecto

\`\`\`
mi-agente-adk/
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ agent.py
‚îú‚îÄ‚îÄ tools.py
‚îî‚îÄ‚îÄ requirements.txt
\`\`\`

### Definir las herramientas

Crea el fichero \`tools.py\`:

\`\`\`python
import httpx
from datetime import datetime

def get_current_time(timezone: str = "UTC") -> dict:
    """Obtiene la hora actual en una zona horaria.
  
    Args:
        timezone: La zona horaria (e.g., "Europe/Madrid", "UTC")
  
    Returns:
        Dict con la hora actual y la zona horaria
    """
    now = datetime.now()
    return {
        "time": now.strftime("%H:%M:%S"),
        "date": now.strftime("%Y-%m-%d"),
        "timezone": timezone
    }

def search_wikipedia(query: str) -> dict:
    """Busca informaci√≥n en Wikipedia.
  
    Args:
        query: T√©rmino de b√∫squeda
  
    Returns:
        Dict con el resumen del art√≠culo
    """
    try:
        url = f"https://en.wikipedia.org/api/rest_v1/page/summary/{query}"
        response = httpx.get(url, timeout=10)
        data = response.json()
        return {
            "title": data.get("title", ""),
            "summary": data.get("extract", "No encontrado"),
            "url": data.get("content_urls", {}).get("desktop", {}).get("page", "")
        }
    except Exception as e:
        return {"error": str(e)}
\`\`\`

### Crear el agente principal

Crea el fichero \`agent.py\`:

\`\`\`python
import asyncio
from dotenv import load_dotenv
from google.adk.agents import LlmAgent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.genai import types

from tools import get_current_time, search_wikipedia

load_dotenv()

# Instrucciones del sistema
SYSTEM_PROMPT = """
Eres un asistente inteligente y amigable. 
Tienes acceso a herramientas para:
- Consultar la hora actual
- Buscar informaci√≥n en Wikipedia

Usa estas herramientas cuando el usuario las necesite.
Responde siempre en el idioma del usuario.
"""

# Crear el agente
root_agent = LlmAgent(
    model="gemini-2.0-flash",
    name="asistente_general",
    description="Agente de prop√≥sito general con acceso a tiempo y Wikipedia",
    instruction=SYSTEM_PROMPT,
    tools=[get_current_time, search_wikipedia],
)

async def main():
    """Punto de entrada principal."""
    session_service = InMemorySessionService()
    runner = Runner(
        agent=root_agent,
        app_name="mi-agente",
        session_service=session_service
    )
  
    # Crear sesi√≥n
    session = await session_service.create_session(
        app_name="mi-agente",
        user_id="usuario-001"
    )
  
    print("ü§ñ Agente listo. Escribe 'salir' para terminar.\\n")
  
    while True:
        user_input = input("T√∫: ").strip()
        if user_input.lower() in ['salir', 'exit', 'quit']:
            break
        if not user_input:
            continue
          
        # Enviar mensaje al agente
        response = await runner.run_async(
            user_id="usuario-001",
            session_id=session.id,
            new_message=types.Content(
                role="user",
                parts=[types.Part(text=user_input)]
            )
        )
      
        # Mostrar respuesta
        for event in response:
            if event.is_final_response():
                print(f"Agente: {event.content.parts[0].text}\\n")

if __name__ == "__main__":
    asyncio.run(main())
\`\`\`

---

## Ejecutar y Probar

duration: 8

Momento de ver nuestro agente en acci√≥n.

### Ejecuci√≥n en terminal

\`\`\`bash
python agent.py
\`\`\`

Deber√≠as ver:

\`\`\`
ü§ñ Agente listo. Escribe 'salir' para terminar.

T√∫: ¬øQu√© hora es?
Agente: Son las 14:32:15 (UTC). ¬øEn qu√© zona horaria te encuentras?

T√∫: Busca informaci√≥n sobre Python
Agente: Python es un lenguaje de programaci√≥n de alto nivel...
\`\`\`

### UI Web con ADK

ADK incluye una interfaz web para desarrollo. Ejecuta:

\`\`\`bash
adk web
\`\`\`

Abre tu navegador en \`http://localhost:8000\` y ver√°s la interfaz de pruebas del agente.

> aside positive
> **Tip:** La UI web de ADK muestra el razonamiento del agente paso a paso, muy √∫til para depurar.

### Ejecutar tests

\`\`\`bash
python -m pytest tests/ -v
\`\`\`

---

## Despliegue en Cloud Run

duration: 10

Desplegamos nuestro agente a producci√≥n con Google Cloud Run.

### Crear el Dockerfile

\`\`\`dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8080

CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8080"]
\`\`\`

### Crear el servidor web

\`\`\`python
# app.py - servidor FastAPI para Cloud Run
from fastapi import FastAPI
from pydantic import BaseModel
from google.adk.agents import LlmAgent
from tools import get_current_time, search_wikipedia

app = FastAPI()

agent = LlmAgent(
    model="gemini-2.0-flash",
    name="asistente_web",
    tools=[get_current_time, search_wikipedia],
)

class Message(BaseModel):
    text: str
    session_id: str = "default"

@app.post("/chat")
async def chat(message: Message):
    # Procesar mensaje con el agente
    response = await agent.process(message.text)
    return {"response": response}

@app.get("/health")
def health():
    return {"status": "ok"}
\`\`\`

### Desplegar a Cloud Run

\`\`\`bash
# Build y push de la imagen
gcloud run deploy mi-agente \\
  --source . \\
  --region us-central1 \\
  --allow-unauthenticated \\
  --set-env-vars GOOGLE_CLOUD_PROJECT=tu-project-id

# Ver la URL del servicio
gcloud run services describe mi-agente \\
  --region us-central1 \\
  --format 'value(status.url)'
\`\`\`

> aside negative
> **Seguridad:** Para producci√≥n, usa \`--no-allow-unauthenticated\` y gestiona la autenticaci√≥n con IAM.

---

## ¬°Enhorabuena!

Has completado el codelab de Google ADK con Python. Ahora sabes c√≥mo:

- ‚úÖ Configurar un entorno de desarrollo para ADK
- ‚úÖ Crear herramientas personalizadas para tu agente
- ‚úÖ Construir un agente con \`LlmAgent\`
- ‚úÖ Ejecutar y probar el agente localmente
- ‚úÖ Desplegar el agente en Google Cloud Run

### Pr√≥ximos pasos

Explora estos recursos para seguir aprendiendo:

- [Documentaci√≥n oficial de ADK](https://google.github.io/adk-docs/)
- [Ejemplos en GitHub](https://github.com/google/adk-samples)
- [Vertex AI Agent Engine](https://cloud.google.com/vertex-ai/generative-ai/docs/agent-engine/overview)

### Limpieza de recursos

Para evitar cargos innecesarios en Google Cloud:

\`\`\`bash
# Eliminar el servicio de Cloud Run
gcloud run services delete mi-agente --region us-central1

# O eliminar el proyecto completo
gcloud projects delete tu-project-id
\`\`\`
`;

// Auto-load on page load
window.addEventListener('DOMContentLoaded', () => {
  try {
    CodelabApp.init(EMBEDDED_MARKDOWN);
  } catch (err) {
    showToast('Error al cargar el codelab: ' + err.message);
    console.error(err);
  }
});

// Init: sidebar hidden on mobile by default
if (window.innerWidth <= 768) sidebar.classList.add('hidden');
</script>
</body>
</html>
